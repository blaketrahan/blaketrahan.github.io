<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <meta name='description' content='blog'>
  <meta name='author' content='blake trahan'>
  <meta name='keywords' content='blake trahan, artist, blog, writing'>
  <title>blake trahan</title>
</head>
<body>
  <style>
    img {
      max-width: 350px;
    }
    #primaryImage {
      border: 1px solid blue;
      display: inline-block;
    }
    pre {
      max-width: 100%;
      overflow: scroll;
    }
  </style>
  <form id='metsearch' style="display:inline-block;">
  	<label>met object id search</label>
  	<input type='text' name='objectid' required>
  	<input type='submit' name='submit'>
  </form>
  <button id="random" style="display:inline-block;">Random (with image)</button>
    <hr>
    <div>Primary Image</div>
  <a id='primaryImage' href="" target="_blank" style='display: none;'>
    <img id='primaryImageSmall' src=''>
  <div>Click to view hi-res</div>
  </a>
  <hr>
  <div>Additional Images</div>
  <div id='additionalImages'></div>
  <hr>
  <div>Data</div>
  <div id='message'></div>
  <script>
    const primaryImg = document.getElementById('primaryImage');
    const smallImg = document.getElementById('primaryImageSmall');
    const msg = document.getElementById('message');
    const addImg = document.getElementById('additionalImages');
    const form = document.getElementById('metsearch');
    const randomBtn = document.getElementById('random');
    let isRandom = false;

  	form.addEventListener('submit', function (e) {
  		e.preventDefault();
      form.submit.disabled = true;
      randomBtn.disabled = true;
      primaryImg.href = '';
      smallImg.src = '';
      addImg.innerHTML = '';
      primaryImg.style.display = 'none';
  		const url = `https://collectionapi.metmuseum.org/public/collection/v1/objects/${this.objectid.value}`;
  		fetch(url)
  		.then((resp) => resp.json())
  		.then((resp) => {
        if (resp.primaryImage) {
          primaryImg.href = resp.primaryImage;
          primaryImg.style.display = 'inline-block';
          isRandom = false;
        } else {
          if (isRandom) {
            setTimeout(() => {
              msg.innerHTML = 'Searching for result with images...';
              randomBtn.click();
            }, 500);
          }
        }
  			if (resp.primaryImageSmall) {
  				smallImg.src = resp.primaryImageSmall;
  			} else if (resp.primaryImage) {
          smallImg.src = resp.primaryImage
        }
        if (resp.additionalImages) {
          for (const img of resp.additionalImages) {
            const i = document.createElement('img');
            i.src = img;
            addImg.appendChild(i);
          }
        }
        msg.innerHTML = '<pre>' + JSON.stringify(resp, null, 2) + '</pre>';
  		})
  		.catch(e => { 
        msg.innerHTML = JSON.stringify(e);
        console.log(e)
      })
      .finally(() => {
        form.submit.disabled = false;
        randomBtn.disabled = false;
      });
  	});
    let objects = null;
    randomBtn.addEventListener('click', async (e) => {
      randomBtn.disabled = true;
      form.submit.disabled = true;
      if (!objects) {
        const url = 'https://collectionapi.metmuseum.org/public/collection/v1/objects';
        await fetch(url).then((resp) => resp.json()).then((resp) => {
          objects = resp;
        });
      }
      const r = Math.floor(Math.random()*objects.objectIDs.length);
      form.objectid.value = objects.objectIDs[r];
      isRandom = true;
      form.submit.disabled = false;
      form.submit.click();
    });
  </script>
</body>
</html>